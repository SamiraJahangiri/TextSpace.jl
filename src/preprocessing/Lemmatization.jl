
irregular_nouns_english = Dict(
    "mice"          => "mouse",
    "geese"         => "goose",
    "men"           => "man",
    "women"         => "woman",
    "children"      => "child",
    "feet"          => "foot",
    "teeth"         => "tooth",
    "oxen"          => "ox",
    "lice"          => "louse",
    "people"        => "person",
    "alumni"        => "alumnus",
    "alumnae"       => "alumna",
    "appendices"    => "appendix",
    "matrices"      => "matrix",
    "vertices"      => "vertex",
    "indices"       => "index",
    "dice"          => "die",
    "crises"        => "crisis",
    "analyses"      => "analysis",
    "diagnoses"     => "diagnosis",
    "oases"         => "oasis",
    "ellipses"      => "ellipse",
    "hypotheses"    => "hypothesis",
    "theses"        => "thesis",
    "phenomena"     => "phenomenon",
    "criteria"      => "criterion",
    "data"          => "datum",
    "stimuli"       => "stimulus",
    "vertebrae"     => "vertebra",
    "curricula"     => "curriculum",
    "genera"        => "genus",
    "taxa"          => "taxon",
    "media"         => "medium",
    "memoranda"     => "memorandum",
    "cacti"         => "cactus",
    "fungi"         => "fungus",
    "pence"         => "penny",
    "sheaves"       => "sheaf",
    "knives"        => "knife",
    "leaves"        => "leaf",
    "halves"        => "half",
    "lives"         => "life",
    "wolves"        => "wolf",
    "calves"        => "calf",
    "scarves"       => "scarf",
    "loaves"        => "loaf",
    "thieves"       => "thief",
    "shelves"       => "shelf",
    "dwarves"       => "dwarf",
    "elves"         => "elf",
    "hippopotami"   => "hippopotamus",
    "octopodes"     => "octopus",
    "foci"          => "focus",
    "nuclei"        => "nucleus",
    "stadia"        => "stadium",
    "millennia"     => "millennium",
    "strata"        => "stratum",
    "addenda"       => "addendum",
    "formulae"      => "formula",
    "larvae"        => "larva",
    "nebulae"       => "nebula",
    "corpora"       => "corpus",
    "errata"        => "erratum",
    "graffiti"      => "graffito",
    "ephemerides"   => "ephemeris",
    "ova"           => "ovum",
    "schemata"      => "schema",
    "stigmata"      => "stigma",
    "sulci"         => "sulcus",
    "bacteria"      => "bacterium",
    "vitae"         => "vita",
    "stamina"       => "stamen",
    "codices"       => "codex",
    "loci"          => "locus",
    "genii"         => "genius",
    "cortices"      => "cortex",
    "bureaux"       => "bureau",
    "testes"        => "testis",
    "ganglia"       => "ganglion",
    "coxae"         => "coxa",
    "ulnae"         => "ulna",
    "radii"         => "radius",
    "pedes"         => "pes",
    "capitula"      => "capitulum",
    "insulae"       => "insula",
    "algae"         => "alga",
    "swine"         => "swine",
    "diagrammata"   => "diagramma",
    "cherubim"      => "cherub",
    "seraphim"      => "seraph",
    "candelabra"    => "candelabrum",
    "viri"          => "vir",
    "capita"        => "caput",
    "sheep"         => "sheep",
    "deer"          => "deer",
    "fish"          => "fish",
    "series"        => "series",
    "species"       => "species",
    "aircraft"      => "aircraft",
    "barracks"      => "barracks"
)


irregular_verbs_english = Dict(
    # Forms of "be"
    "am"      => "be",
    "are"     => "be",
    "is"      => "be",
    "was"     => "be",
    "were"    => "be",
    "been"    => "be",
    "being"   => "be",

    # become
    "became"  => "become",
    "become"  => "become",

    # begin
    "began"   => "begin",
    "begun"   => "begin",
    "begin"   => "begin",

    # break
    "broke"   => "break",
    "broken"  => "break",
    "break"   => "break",

    # bring
    "brought" => "bring",
    "bring"   => "bring",

    # build
    "built"   => "build",
    "build"   => "build",

    # buy
    "bought"  => "buy",
    "buy"     => "buy",

    # catch
    "caught"  => "catch",
    "catch"   => "catch",

    # choose
    "chose"   => "choose",
    "chosen"  => "choose",
    "choose"  => "choose",

    # come
    "came"    => "come",
    "come"    => "come",

    # cost
    "cost"    => "cost",

    # cut
    "cut"     => "cut",

    # deal
    "dealt"   => "deal",
    "deal"    => "deal",

    # dig
    "dug"     => "dig",
    "dig"     => "dig",

    # do
    "did"     => "do",
    "done"    => "do",
    "do"      => "do",

    # draw
    "drew"    => "draw",
    "drawn"   => "draw",
    "draw"    => "draw",

    # drink
    "drank"   => "drink",
    "drunk"   => "drink",
    "drink"   => "drink",

    # drive
    "drove"   => "drive",
    "driven"  => "drive",
    "drive"   => "drive",

    # eat
    "ate"     => "eat",
    "eaten"   => "eat",
    "eat"     => "eat",

    # fall
    "fell"    => "fall",
    "fallen"  => "fall",
    "fall"    => "fall",

    # feed
    "fed"     => "feed",
    "feed"    => "feed",

    # feel
    "felt"    => "feel",
    "feel"    => "feel",

    # fight
    "fought"  => "fight",
    "fight"   => "fight",

    # find
    "found"   => "find",
    "find"    => "find",

    # fly
    "flew"    => "fly",
    "flown"   => "fly",
    "fly"     => "fly",

    # forget
    "forgot"  => "forget",
    "forgotten" => "forget",
    "forget"  => "forget",

    # forgive
    "forgave"   => "forgive",
    "forgiven"  => "forgive",
    "forgive"   => "forgive",

    # freeze
    "froze"   => "freeze",
    "frozen"  => "freeze",
    "freeze"  => "freeze",

    # get
    "got"     => "get",
    "gotten"  => "get",
    "get"     => "get",

    # give
    "gave"    => "give",
    "given"   => "give",
    "give"    => "give",

    # go
    "went"    => "go",
    "gone"    => "go",
    "go"      => "go",

    # grow
    "grew"    => "grow",
    "grown"   => "grow",
    "grow"    => "grow",

    # hang
    "hung"    => "hang",
    "hang"    => "hang",

    # have
    "had"     => "have",
    "have"    => "have",

    # hear
    "heard"   => "hear",
    "hear"    => "hear",

    # hide
    "hid"     => "hide",
    "hidden"  => "hide",
    "hide"    => "hide",

    # hit
    "hit"     => "hit",

    # hold
    "held"    => "hold",
    "hold"    => "hold",

    # hurt
    "hurt"    => "hurt",

    # keep
    "kept"    => "keep",
    "keep"    => "keep",

    # kneel
    "knelt"   => "kneel",
    "kneel"   => "kneel",

    # know
    "knew"    => "know",
    "known"   => "know",
    "know"    => "know",

    # lay (to put down)
    "laid"    => "lay",
    "lay"     => "lay",

    # lead
    "led"     => "lead",
    "lead"    => "lead",

    # lean
    "leant"   => "lean",
    "leaned"  => "lean",
    "lean"    => "lean",

    # learn
    "learnt"  => "learn",
    "learned" => "learn",
    "learn"   => "learn",

    # leave
    "left"    => "leave",
    "leave"   => "leave",

    # lend
    "lent"    => "lend",
    "lend"    => "lend",

    # let
    "let"     => "let",

    # lie (recline)
    # Note: "lay" is ambiguous so we include the forms for "lie" (to recline)
    "lay"     => "lie",    # past of "lie" (recline)
    "lain"    => "lie",
    "lie"     => "lie",

    # light
    "lit"     => "light",
    "light"   => "light",

    # lose
    "lost"    => "lose",
    "lose"    => "lose",

    # make
    "made"    => "make",
    "make"    => "make",

    # mean
    "meant"   => "mean",
    "mean"    => "mean",

    # meet
    "met"     => "meet",
    "meet"    => "meet",

    # mislay
    "mislaid" => "mislay",
    "mislay"  => "mislay",

    # mistake
    "mistook"   => "mistake",
    "mistaken"  => "mistake",
    "mistake"   => "mistake",

    # mow
    "mowed"   => "mow",
    "mown"    => "mow",
    "mow"     => "mow",

    # overcome
    "overcame" => "overcome",
    "overcome" => "overcome",

    # pay
    "paid"    => "pay",
    "pay"     => "pay",

    # put
    "put"     => "put",

    # read (spelling remains the same though pronunciation changes)
    "read"    => "read",

    # ride
    "rode"    => "ride",
    "ridden"  => "ride",
    "ride"    => "ride",

    # ring
    "rang"    => "ring",
    "rung"    => "ring",
    "ring"    => "ring",

    # rise
    "rose"    => "rise",
    "risen"   => "rise",
    "rise"    => "rise",

    # run
    "ran"     => "run",
    "run"     => "run",

    # say
    "said"    => "say",
    "say"     => "say",

    # see
    "saw"     => "see",
    "seen"    => "see",
    "see"     => "see",

    # seek
    "sought"  => "seek",
    "seek"    => "seek",

    # sell
    "sold"    => "sell",
    "sell"    => "sell",

    # send
    "sent"    => "send",
    "send"    => "send",

    # set
    "set"     => "set",

    # sew
    "sewed"   => "sew",
    "sewn"    => "sew",
    "sew"     => "sew",

    # shake
    "shook"   => "shake",
    "shaken"  => "shake",
    "shake"   => "shake",

    # shave
    "shaved"  => "shave",
    "shaven"  => "shave",
    "shave"   => "shave",

    # shear
    "sheared" => "shear",
    "shorn"   => "shear",
    "shear"   => "shear",

    # shine
    "shone"   => "shine",
    "shine"   => "shine",

    # shoot
    "shot"    => "shoot",
    "shoot"   => "shoot",

    # show
    "showed"  => "show",
    "shown"   => "show",
    "show"    => "show",

    # shrink
    "shrank"  => "shrink",
    "shrunk"  => "shrink",
    "shrink"  => "shrink",

    # shut
    "shut"    => "shut",

    # sing
    "sang"    => "sing",
    "sung"    => "sing",
    "sing"    => "sing",

    # sink
    "sank"    => "sink",
    "sunk"    => "sink",
    "sink"    => "sink",

    # sit
    "sat"     => "sit",
    "sit"     => "sit",

    # sleep
    "slept"   => "sleep",
    "sleep"   => "sleep",

    # slide
    "slid"    => "slide",
    "slide"   => "slide",

    # speak
    "spoke"   => "speak",
    "spoken"  => "speak",
    "speak"   => "speak",

    # spend
    "spent"   => "spend",
    "spend"   => "spend",

    # spill
    "spilt"   => "spill",
    "spilled" => "spill",
    "spill"   => "spill",

    # spin
    "spun"    => "spin",
    "spin"    => "spin",

    # spit
    "spit"    => "spit",

    # split
    "split"   => "split",

    # spread
    "spread"  => "spread",

    # spring
    "sprang"  => "spring",
    "sprung"  => "spring",
    "spring"  => "spring",

    # stand
    "stood"   => "stand",
    "stand"   => "stand",

    # steal
    "stole"   => "steal",
    "stolen"  => "steal",
    "steal"   => "steal",

    # stick
    "stuck"   => "stick",
    "stick"   => "stick",

    # sting
    "stung"   => "sting",
    "sting"   => "sting",

    # stink
    "stank"   => "stink",
    "stunk"   => "stink",
    "stink"   => "stink",

    # stride
    "strode"  => "stride",
    "stridden"=> "stride",
    "stride"  => "stride",

    # strike
    "struck"    => "strike",
    "stricken"  => "strike",
    "strike"    => "strike",

    # string
    "strung"  => "string",
    "string"  => "string",

    # strive
    "strove"  => "strive",
    "striven" => "strive",
    "strive"  => "strive",

    # swear
    "swore"   => "swear",
    "sworn"   => "swear",
    "swear"   => "swear",

    # sweep
    "swept"   => "sweep",
    "sweep"   => "sweep",

    # swim
    "swam"    => "swim",
    "swum"    => "swim",
    "swim"    => "swim",

    # swing
    "swung"   => "swing",
    "swing"   => "swing",

    # take
    "took"    => "take",
    "taken"   => "take",
    "take"    => "take",

    # teach
    "taught"  => "teach",
    "teach"   => "teach",

    # tear
    "tore"    => "tear",
    "torn"    => "tear",
    "tear"    => "tear",

    # tell
    "told"    => "tell",
    "tell"    => "tell",

    # think
    "thought" => "think",
    "think"   => "think",

    # throw
    "threw"   => "throw",
    "thrown"  => "throw",
    "throw"   => "throw",

    # understand
    "understood" => "understand",
    "understand" => "understand",

    # uphold
    "upheld"  => "uphold",
    "uphold"  => "uphold",

    # wake
    "woke"    => "wake",
    "woken"   => "wake",
    "wake"    => "wake",

    # wear
    "wore"    => "wear",
    "worn"    => "wear",
    "wear"    => "wear",

    # weave
    "wove"    => "weave",
    "woven"   => "weave",
    "weave"   => "weave",

    # weep
    "wept"    => "weep",
    "weep"    => "weep",

    # win
    "won"     => "win",
    "win"     => "win",

    # wind
    "wound"   => "wind",
    "wind"    => "wind",

    # withdraw
    "withdrew"  => "withdraw",
    "withdrawn" => "withdraw",
    "withdraw"  => "withdraw",

    # write
    "wrote"   => "write",
    "written" => "write",
    "write"   => "write"
)

# Function to transform a given verb into its base (lemma) form.
# The transformation applies simple suffix removal rules.
function transform_verb(verb::String)
    lw = lowercase(verb)
    
    if endswith(lw, "ies") && length(lw) > 3
        return lw[1:end-3] * "y"
    
    # Rule for verbs ending with "ied" (e.g., "tried" -> "try")
    elseif endswith(lw, "ied") && length(lw) > 3
        return lw[1:end-3] * "y"
    
    # Rule for verbs ending with "ing"
    # Only apply if the string is sufficiently long to avoid over-stripping short words.
    elseif endswith(lw, "ing") && length(lw) > 4
        base = lw[1:end-3]
        # Check for doubled final letters (common after removal of 'ing').
        # e.g., "swimming" → "swimm" becomes "swim".
        if length(base) > 1 && base[end] == base[end-1]
            base = base[1:end-1]
        end
        return base
    
    # Rule for verbs ending with "ed"
    # This covers many regular past forms.
    elseif endswith(lw, "ed") && length(lw) > 3
        base = lw[1:end-2]
        # Handle cases with doubling (e.g., "stopped" -> "stopp" becomes "stop").
        if length(base) > 1 && base[end] == base[end-1]
            base = base[1:end-1]
        end
        return base
    
    # Rule for verbs ending in "es"
    # This is common for verbs that add -es in third-person singular (e.g., "watches" -> "watch")
    elseif endswith(lw, "es") && length(lw) > 3
        base = lw[1:end-2]
        return base
    
    # Rule for verbs ending with a trailing "s"
    # This catches a third-person singular form that hasn’t already been handled,
    # e.g., "runs" → "run". We require a bit of minimum length so that
    # invariant verbs like "is" or "has" are not over-trimmed.
    elseif endswith(lw, "s") && length(lw) > 3
        return lw[1:end-1]
    end
    
    # If none of the suffix rules match, return the original normalized verb.
    return lw
end



function lemmatize_text(text::String; language::String="english") 
    words = split(text) 
    lemmas = [lemmatize_word(w; language=language) for w in words] 
    return join(lemmas, ' ') 
end

function lemmatize_word(word::String; language::String="english")
    #convert to lowercase to match dictionary patterns 
    lw = lowercase(word)

    if language == "english"
        if haskey(irregular_nouns_english, lw)
            return irregular_nouns_english[lw]
        end   

        if haskey(irregular_verbs_english, lw)
            return irregular_verbs_english[lw]
        end
    
        #simple verb transformation: remove trailing "ing" or "ed" if present
        lw = transform_verb(lw)

    end
    
    return lw
end


# function endswith(word::String, suffix::String) 
#     return length(word) >= length(suffix) && word[end-length(suffix)+1:end] == suffix 
# end